---
layout:  post
title: "NYC interactive zip-level map"
comments:  true
published:  true
author: "Sebastian Perez Saaibi"
date: "`r format(Sys.time(), '%d %B, %Y')`"
categories: [Maps, ggplot2, htmlwidgets]
output:
  html_document:
    mathjax:  default
    fig_caption:  true
---


In this post, I will briefly explore how to make an interactive, zipcode-level map of Manhattan an Brooklyn using `ggplot2` and a few additional packages, such as: `ggalt`, `ggiraph`, `ggthemes`, `viridis`, `choroplethr`, `choroplethrZip`.

My motivation was to have an interactive map of the US, at a detailed (zip level) that I could overlay with some information on mouseover or click.

I combined the approach of a couple posts from [hrbrmstr](http://rpubs.com/hrbrmstr/barcharttooltipsggiraph) and [arilamstein](http://rpubs.com/arilamstein/zip-vignette-1). Feel free to check them out for your reference!

If you want to see the `.Rmd` document, and the code used to generate this post, you can see the [source](https://github.com/spsaaibi/spsaaibi.github.io/blob/master/_source/2016-01-31-zip_map_nyc.Rmd).


```{r,echo=FALSE, warning=FALSE, message= FALSE, results='asis'}
# for reference, take a look at: 
# choroplethrZip: http://rpubs.com/arilamstein/zip-vignette-1
# ggmap ggiraph: http://rpubs.com/hrbrmstr/barcharttooltipsggiraph

library(ggplot2)
library(ggalt)
library(ggiraph)
library(ggthemes)
library(viridis)
library(choroplethr)
library(choroplethrZip)
```

```{r,echo=FALSE, warning=FALSE, message= FALSE, results='asis'}
data("df_pop_zip")

data <- df_pop_zip

data$onclick <- sprintf(
  "function() {window.open('%s%s')}",
  "http://www.city-data.com/zips/",
  paste0(as.character(data$region),".html"))

max_bar <- max(data$value)

## manhattan and brooklyn
nyc_fips = c(36047, 36061)

map_title <- "2012 New York City ZCTA Population Estimates"
map_legend <- "Population"

data$tip <- sprintf('
                      <div style="text-align:left;">
                      <span style="font-size:14px"><b>Population for Zip: </b>%s</span><br/>
                      <table>
                      <tr valign="center"><td>Population:</td><td style="width:300px"><div style="background-color: steelblue; font: 9px sans-serif; text-align: left; padding: 3px; margin: 1px; line-height:10px; color: white; width: %dpx;">%3.1f</div></td></tr>
                      </div>',
                      data$region,
                      round((data$value/(max_bar)*100)),data$value
                      
)

data$tip <- gsub("\\\n", "", data$tip)

zip_map_var <- zip_choropleth(data,
               county_zoom=nyc_fips,
               title=map_title,
               legend=map_legend)


gg <- ggplot()
gg <- gg + geom_map_interactive(
  map=zip_map_var$data, data=data,
  aes(fill=value, tooltip=tip, onclick=onclick,
      data_id=region, map_id=region),
  color="white", size=0.15)
gg <- gg + scale_fill_viridis()
#gg <- gg + coord_proj("+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96")
gg <- gg + coord_proj(
  paste0("+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96",
         " +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"))
gg <- gg + ggtitle(map_title)
gg <- gg + expand_limits(x=zip_map_var$data$long, y=zip_map_var$data$lat)
gg <- gg + theme_map()
gg <- gg + theme(legend.position="right")
gg <- gg + theme(plot.title=element_text(hjust=0.5, size=24))

ggiraph(code = {print(gg)}, width = 8, height = 6)

```

As you can see, this is a very simple plot of the population density for the zipcodes in manhattan and brooklyn in 2012. This could be an interesting starting point to create similar maps of different types of socio-economic data: number of calls to 911 on a specific period, number of robberies reported, ...

Let me know if you found it useful!
